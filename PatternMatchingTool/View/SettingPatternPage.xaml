<Page
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wf="clr-namespace:System.Windows.Forms;assembly=System.Windows.Forms"
        xmlns:wfi="clr-namespace:System.Windows.Forms.Integration;assembly=WindowsFormsIntegration"
        xmlns:cognex="clr-namespace:Cognex.VisionPro.Display;assembly=Cognex.VisionPro.Display.Controls"
        xmlns:converters="clr-namespace:PatternMatchingTool.Converter"
        xmlns:local="clr-namespace:PatternMatchingTool.Behavior"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml" x:Class="PatternMatchingTool.View.SettingPatternPage"
        mc:Ignorable="d"
        Title="SettingPatternPage" MouseLeftButtonDown="Page_MouseLeftButtonDown" >

     <Page.Resources>
     <converters:BitmapSourceConverter x:Key="BitmapSourceConvert" />
     <converters:BoolToBrushConverter x:Key="BoolToBrushConvert" />
     <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConvert"/>
    </Page.Resources>
 
 <Grid>
     <Grid.ColumnDefinitions>
         <ColumnDefinition Width="*"/>
         <ColumnDefinition Width="350"/>
     </Grid.ColumnDefinitions>

     <!-- 왼쪽: 버튼 + CogDisplay -->
     <Grid Grid.Column="0" Margin="5">
         <Grid.RowDefinitions>
             <!-- 버튼 -->
             <RowDefinition Height="Auto"/>
             <!-- CogDisplay -->
             <RowDefinition Height="Auto"/>
         </Grid.RowDefinitions>

         <DockPanel Grid.Row="0" Margin="3" LastChildFill="False">
             <Button Content="Grab Image" TextBlock.FontSize="12" Height="35" Width="120" Margin="3" Background="Black" DockPanel.Dock="Left" Command="{Binding GrabImageCommand}" />
             <Button Content="Grab Camera" TextBlock.FontSize="12" Height="35" Width="120" Margin="3" Background="Black" DockPanel.Dock="Left" Command="{Binding GrabCameraCommand}"/>
             <Button Content="Load Image" TextBlock.FontSize="12" Height="35" Width="120" Margin="3" Background="Black" DockPanel.Dock="Left" Command="{Binding LoadImageCommand}"/>
             <Button Content="Test Run" TextBlock.FontSize="12" Height="35" Width="120" Margin="3" Background="Black" DockPanel.Dock="Right" Command="{Binding CutCommand}"/>
         </DockPanel>

            <Border Background="Black" Grid.Row="1">
                <Viewbox Grid.Row="1"
         Stretch="Uniform"
         ClipToBounds="True"
         Grid.RowSpan="2"
         Height="650">
                    <Grid>
                        <Image Name="CameraImage"
                    Stretch="Uniform"
                    Height="650"
                    Source="{Binding DisplayBitmap, Converter={StaticResource BitmapSourceConvert}}"/>
                        <!-- 결과 Rect -->
                        <Canvas IsHitTestVisible="False">
                            <Rectangle Stroke="Red" StrokeThickness="5"
                    Width="{Binding ResultRect.Width}"
                    Height="{Binding ResultRect.Height}"
                    Canvas.Left="{Binding ResultRect.X}"
                    Canvas.Top="{Binding ResultRect.Y}"/>
                        </Canvas>
                        <!-- 패턴 Rect -->
                        <Canvas IsHitTestVisible="True">
                            <Rectangle x:Name="PatternRect" Stroke="Green" StrokeThickness="2"
                        Width="{Binding PatternRect.Width}"
                        Height="{Binding PatternRect.Height}"
                        Canvas.Left="{Binding PatternRect.X}"
                        Canvas.Top="{Binding PatternRect.Y}"
                        Fill="Transparent">
                                <i:Interaction.Behaviors>
                                    <local:RectBehavior />
                                </i:Interaction.Behaviors>
                            </Rectangle>
                            <!-- 크기 조절 원 -->
                            <Ellipse x:Name="TopLeft"
             Width="7" Height="7"
             Fill="Green" Stroke="Green" StrokeThickness="2"
             Visibility="{Binding IsPatternRectClick, Converter={StaticResource BoolToVisibilityConverter}}"
             Canvas.Left="{Binding PatternRectLeftTopX}"
             Canvas.Top="{Binding PatternRectLeftTopY}"
             Cursor="SizeNWSE">
                                <i:Interaction.Behaviors>
                                    <local:ResizeCircleBehavior />
                                </i:Interaction.Behaviors>
                            </Ellipse>

                            <Ellipse x:Name="TopRight"
             Width="7" Height="7"
             Fill="Green" Stroke="Green" StrokeThickness="2"
             Visibility="{Binding IsPatternRectClick, Converter={StaticResource BoolToVisibilityConverter}}"
             Canvas.Left="{Binding PatternRectRightTopX}"
             Canvas.Top="{Binding PatternRectRightTopY}"
             Cursor="SizeNESW">
                                <i:Interaction.Behaviors>
                                    <local:ResizeCircleBehavior />
                                </i:Interaction.Behaviors>
                            </Ellipse>

                            <Ellipse x:Name="BottomLeft"
             Width="7" Height="7"
             Fill="Green" Stroke="Green" StrokeThickness="2"
             Visibility="{Binding IsPatternRectClick, Converter={StaticResource BoolToVisibilityConverter}}"
             Canvas.Left="{Binding PatternRectLeftBottomX}"
             Canvas.Top="{Binding PatternRectLeftBottomY}"
             Cursor="SizeNESW">
                                <i:Interaction.Behaviors>
                                    <local:ResizeCircleBehavior />
                                </i:Interaction.Behaviors>
                            </Ellipse>

                            <Ellipse x:Name="BottomRight"
             Width="7" Height="7"
             Fill="Green" Stroke="Green" StrokeThickness="2"
             Visibility="{Binding IsPatternRectClick, Converter={StaticResource BoolToVisibilityConverter}}"
             Canvas.Left="{Binding PatternRectRightBottomX}"
             Canvas.Top="{Binding PatternRectRightBottomY}"
             Cursor="SizeNWSE">
                                <i:Interaction.Behaviors>
                                    <local:ResizeCircleBehavior />
                                </i:Interaction.Behaviors>
                            </Ellipse>
                        </Canvas>
                    </Grid>
                </Viewbox>
            </Border>
        </Grid>
     <!-- 오른쪽: 패턴 설정 -->
     <StackPanel Grid.Column="1" Margin="5" Width="300">
         <DockPanel Margin="10, 5, 10, 5" LastChildFill="False">
                <GroupBox Margin="5" Header="Pattern" Foreground="White">
                    <Border Background="Black">
                        <Viewbox Width="200" Height="200">
                            <Image Name="PatternImage" Stretch="Uniform" Height="200"
                        Source="{Binding PatternBitmap, Converter={StaticResource BitmapSourceConvert}}"/>
                    </Viewbox>
                    </Border>
                </GroupBox>
            </DockPanel>
            <DockPanel Margin="10, 0, 10, 10" LastChildFill="False">
                <GroupBox Margin="5" Header="PATTERN LIST" Foreground="White" Width="215">
                    <DataGrid Background="White" Height="150"/>
                </GroupBox>
            </DockPanel>
            <DockPanel Margin="10, 0, 10, 0" LastChildFill="False">
                <Button Margin="5, 0, 5, 0" Width="215" Height="30" Content="TRAIN"/>
            </DockPanel>
            <DockPanel Margin="10, 5, 10, 5" LastChildFill="False">
                <GroupBox Margin="5" Header="Threshold" Foreground="White">
                    <TextBox Width="90" />
                </GroupBox>
                <GroupBox Margin="5" Header="Angle" Foreground="White">
                    <TextBox Width="90" />
                </GroupBox>
            </DockPanel>
         <DockPanel Margin="10, 3, 10, 10" LastChildFill="False">
                <GroupBox Margin="5, 0, 5, 0" Header="Result" Foreground="White" Width="215">
                    <StackPanel>
                        <DockPanel>
                            <TextBlock Text="SCORE :" Margin="5"/>
                            <TextBlock/>
                        </DockPanel>
                        <DockPanel>
                            <TextBlock Text="ANGLE :" Margin="5"/>
                            <TextBlock/>
                        </DockPanel>
                    </StackPanel>
                </GroupBox>
         </DockPanel>
         <DockPanel Margin="10" LastChildFill="False">
                <Button Margin="5, 0, 5, 0" Content="SAVE" Width="215" Height="30" Command="{Binding SaveIDParametersCommand}" />
         </DockPanel>
     </StackPanel>
 </Grid>
</Page>
